# Feature Inventory

Generated: `2026-02-10T18:05:18.546Z` (commit `2f02e09f5e53`)

This document is generated by `npm run report:features`.

## Feature Flags

Total: **6** (booleans: **5**, enums: **1**)
Off by default: **5**
Unused (declared but not referenced): **0**
Paper flags (non-test lane, runtime usage = 0): **0**
Unknown usages (referenced but not declared): **0**

Notes:
- Runtime usage is best-effort based on string-literal references in source. Indirection can undercount.
- Flag lifecycle metadata (lane/owner/sunset) is required to prevent long-lived drift.

| Flag | Lane | Type | Default | Status | Sunset | Used | Runtime | References |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |
| `CHOICE_COMPACT_MODE` | pilot | boolean | `false` | OFF (default) | `2026-04-30` | **1** | **1** | `components/game/GameFooter.tsx` |
| `ENFORCE_REQUIRED_STATE` | pilot | boolean | `false` | OFF (default) | `2026-04-30` | **4** | **1** | `hooks/game/useChoiceHandler.ts`, `tests/lib/feature-flags.test.ts` |
| `GOSSIP_PROPAGATION_V1` | pilot | boolean | `false` | OFF (default) | `2026-04-30` | **1** | **1** | `lib/choice-processors/derivative-orchestrator.ts` |
| `IDENTITY_OFFERING_V1` | pilot | boolean | `false` | OFF (default) | `2026-04-30` | **1** | **1** | `hooks/game/useChoiceHandler.ts` |
| `SCARCITY_MODE_V1` | pilot | boolean | `false` | OFF (default) | `2026-04-30` | **3** | **3** | `hooks/game/useChoiceHandler.ts` |
| `RANKING_V2` | pilot | enum | `control` | default=`control` | `2026-04-30` | **7** | **1** | `hooks/useRanking.ts`, `tests/lib/feature-flags.test.ts` |

### Dev Overrides (Safe)

- Query param (dev only): `?ff_ENFORCE_REQUIRED_STATE=true`
- localStorage (dev only): `localStorage.setItem("ff_ENFORCE_REQUIRED_STATE", "true")`
- Dev console (dev only): `featureFlags.set("ENFORCE_REQUIRED_STATE", true)`
- Build/runtime env: `NEXT_PUBLIC_FF_ENFORCE_REQUIRED_STATE=true`

## Experiments

No active experiments registered in `ACTIVE_TESTS`.

## Telemetry

Analytics contract sources:
- Analytics dictionary: `docs/reference/data-dictionary/12-analytics.md`
- Verifier: `npm run verify:analytics-dict` (`scripts/verify-analytics-dictionary.ts`)
- Interaction events spec: `lib/telemetry/interaction-events-spec.ts`
- Event bus spec: `lib/event-bus.ts`

### Interaction Events (Supabase)

Declared (spec): **6**
Used (code): **6**
Missing in dictionary: **0**
Unknown used (not in spec): **0**

| Event | Documented | Used | Runtime | References |
| --- | --- | --- | --- | --- |
| `choice_compact_toggled` | YES | **2** | **2** | `components/GameChoices.tsx` |
| `choice_presented` | YES | **1** | **1** | `components/GameChoices.tsx` |
| `choice_selected_result` | YES | **1** | **1** | `hooks/game/useChoiceHandler.ts` |
| `choice_selected_ui` | YES | **1** | **1** | `components/GameChoices.tsx` |
| `experiment_assigned` | YES | **1** | **1** | `lib/experiments.ts` |
| `node_entered` | YES | **2** | **2** | `hooks/game/useChoiceHandler.ts`, `hooks/game/useGameInitializer.ts` |

### Event Bus Events

Note: usage is detected via string-literal event names in code (emit/on/off/once and similar), excluding the declaration file itself.

Declared (spec): **50**
Literal used (code): **13**
Status: active **13**, planned **37**, deprecated **0**
Missing in dictionary: **0**
Unknown literals (not in spec): **0**

| Event | Status | Owner | Documented | Used | Runtime | References |
| --- | --- | --- | --- | --- | --- | --- |
| `analytics:tracked` | planned | analytics | YES | 0 | 0 |  |
| `game:arc:completed` | planned | narrative | YES | 0 | 0 |  |
| `game:character:met` | planned | narrative | YES | 0 | 0 |  |
| `game:choice:made` | planned | core | YES | 0 | 0 |  |
| `game:cognitive:flow` | planned | systems | YES | 0 | 0 |  |
| `game:dialogue:completed` | planned | narrative | YES | 0 | 0 |  |
| `game:dialogue:started` | planned | narrative | YES | 0 | 0 |  |
| `game:emotional:calm` | planned | systems | YES | 0 | 0 |  |
| `game:emotional:stress` | planned | systems | YES | 0 | 0 |  |
| `game:golden_prompt:achieved` | planned | simulations | YES | 0 | 0 |  |
| `game:interrupt:available` | planned | systems | YES | 0 | 0 |  |
| `game:interrupt:missed` | planned | systems | YES | 0 | 0 |  |
| `game:interrupt:taken` | planned | systems | YES | 0 | 0 |  |
| `game:knowledge:gained` | planned | systems | YES | 0 | 0 |  |
| `game:message:received` | active | core | YES | **1** | **1** | `hooks/useEventBus.ts` |
| `game:message:streaming` | active | core | YES | **1** | **1** | `hooks/useEventBus.ts` |
| `game:pattern:discovered` | planned | systems | YES | 0 | 0 |  |
| `game:pattern:threshold` | planned | systems | YES | 0 | 0 |  |
| `game:pattern:updated` | planned | systems | YES | 0 | 0 |  |
| `game:platform:updated` | planned | systems | YES | 0 | 0 |  |
| `game:presence:updated` | active | core | YES | **1** | **1** | `hooks/useEventBus.ts` |
| `game:relationship:updated` | planned | narrative-systems | YES | 0 | 0 |  |
| `game:scene:transition` | active | core | YES | **1** | **1** | `hooks/useEventBus.ts` |
| `game:simulation:completed` | planned | simulations | YES | 0 | 0 |  |
| `game:simulation:started` | planned | simulations | YES | 0 | 0 |  |
| `game:skill:unlocked` | planned | systems | YES | 0 | 0 |  |
| `game:skills:updated` | planned | systems | YES | 0 | 0 |  |
| `game:state:changed` | active | core | YES | **1** | **1** | `hooks/useEventBus.ts` |
| `game:trust:changed` | active | core | YES | **1** | **1** | `hooks/useEventBus.ts` |
| `game:vulnerability:revealed` | planned | narrative | YES | 0 | 0 |  |
| `perf:api:slow` | planned | perf | YES | 0 | 0 |  |
| `perf:bundle:large` | planned | perf | YES | 0 | 0 |  |
| `perf:choice:slow` | planned | perf | YES | 0 | 0 |  |
| `perf:memory:warning` | planned | perf | YES | 0 | 0 |  |
| `perf:render:slow` | planned | perf | YES | 0 | 0 |  |
| `system:cleanup` | planned | infra | YES | 0 | 0 |  |
| `system:error` | active | infra | YES | **1** | **1** | `hooks/useEventBus.ts` |
| `system:info` | active | infra | YES | **1** | **1** | `hooks/useEventBus.ts` |
| `system:warning` | active | infra | YES | **1** | **1** | `hooks/useEventBus.ts` |
| `ui:animation:complete` | planned | ui | YES | 0 | 0 |  |
| `ui:animation:start` | planned | ui | YES | 0 | 0 |  |
| `ui:error:hide` | planned | ui | YES | 0 | 0 |  |
| `ui:error:show` | planned | ui | YES | 0 | 0 |  |
| `ui:message:hide` | active | ui | YES | **1** | **1** | `hooks/useEventBus.ts` |
| `ui:message:show` | active | ui | YES | **1** | **1** | `hooks/useEventBus.ts` |
| `ui:modal:closed` | planned | ui | YES | 0 | 0 |  |
| `ui:modal:opened` | planned | ui | YES | 0 | 0 |  |
| `ui:notification:display` | planned | ui | YES | 0 | 0 |  |
| `ui:scene:hide` | active | ui | YES | **1** | **1** | `hooks/useEventBus.ts` |
| `ui:scene:show` | active | ui | YES | **1** | **1** | `hooks/useEventBus.ts` |

## Data Dictionaries

Directory: `docs/reference/data-dictionary`
Files: **15**

- `docs/reference/data-dictionary/00-core-gameplay.md`
- `docs/reference/data-dictionary/00-index.md`
- `docs/reference/data-dictionary/01-emotions.md`
- `docs/reference/data-dictionary/02-skills.md`
- `docs/reference/data-dictionary/03-patterns.md`
- `docs/reference/data-dictionary/04-characters.md`
- `docs/reference/data-dictionary/05-dialogue-system.md`
- `docs/reference/data-dictionary/06-simulations.md`
- `docs/reference/data-dictionary/07-knowledge-flags.md`
- `docs/reference/data-dictionary/08-trust-system.md`
- `docs/reference/data-dictionary/09-interrupts.md`
- `docs/reference/data-dictionary/10-ui-metadata.md`
- `docs/reference/data-dictionary/11-careers.md`
- `docs/reference/data-dictionary/12-analytics.md`
- `docs/reference/data-dictionary/CORE_GAMEPLAY_DATA_DICTIONARY.md`

## localStorage Keys

Total: **46**
Unused (declared but not referenced): **19**
Unknown usages (referenced but not declared): **2** (active: **0**, archived: **2**)

Notes:
- Do not delete unused keys without a migration policy; older builds/users may still read/write them.

| Key | Category | Value | Used | Runtime | References |
| --- | --- | --- | --- | --- | --- |
| `ADMIN_VIEW_MODE` | admin | `lux_story_v2_admin_view_mode` | **3** | **3** | `app/profile/page.tsx`, `lib/settings-sync.ts` |
| `ACTIVE_TABS` | core_game_state | `lux_story_v2_active_tabs` | **5** | **5** | `hooks/useMultiTabSync.ts` |
| `GAME_SAVE` | core_game_state | `lux_story_v2_game_save` | **124** | **1** | `lib/game-state-manager.ts`, `tests/e2e/__verification__/phase1-verification.spec.ts`, `tests/e2e/careers/career-analytics.spec.ts`, `tests/e2e/characters/character-smoke.spec.ts` (+14) |
| `GAME_SAVE_BACKUP` | core_game_state | `lux_story_v2_game_save_backup` | **1** | **1** | `lib/game-state-manager.ts` |
| `GAME_STORE` | core_game_state | `lux_story_v2_game_store` | **5** | **4** | `hooks/useMultiTabSync.ts`, `lib/game-state-manager.ts`, `lib/game-store.ts`, `tests/e2e/constellation/constellation-mobile.spec.ts` |
| `DEV:SHOW_HIDDEN_CHOICES` | dev_tools | `godMode_showHiddenChoices` | **2** | **2** | `lib/dev-tools/god-mode-api.ts` |
| `DEV:SKIP_ANIMATIONS` | dev_tools | `godMode_skipAnimations` | **2** | **2** | `lib/dev-tools/god-mode-api.ts` |
| `CURRENT_SCENE_ID` | error_recovery | `lux_story_v2_current_scene_id` | **1** | **1** | `components/GameErrorBoundary.tsx` |
| `LAST_KNOWN_SCENE_ID` | error_recovery | `lux_story_v2_last_known_scene_id` | **1** | **1** | `components/GameErrorBoundary.tsx` |
| `LEGACY:admin_view_preference` | legacy | `admin_view_preference` | 0 | 0 |  |
| `LEGACY:currentSceneId` | legacy | `currentSceneId` | 0 | 0 |  |
| `LEGACY:gameUserId` | legacy | `gameUserId` | **1** | **1** | `app/student/insights/page.tsx` |
| `LEGACY:grand-central-game-store` | legacy | `grand-central-game-store` | 0 | 0 |  |
| `LEGACY:grand-central-terminus-save` | legacy | `grand-central-terminus-save` | **11** | 0 | `tests/browser-runtime/game-loop-integration.spec.ts` |
| `LEGACY:grand-central-terminus-save-backup` | legacy | `grand-central-terminus-save-backup` | 0 | 0 |  |
| `LEGACY:lastKnownSceneId` | legacy | `lastKnownSceneId` | 0 | 0 |  |
| `LEGACY:lux_accessibility_profile` | legacy | `lux_accessibility_profile` | 0 | 0 |  |
| `LEGACY:lux_audio_muted` | legacy | `lux_audio_muted` | 0 | 0 |  |
| `LEGACY:lux_audio_volume` | legacy | `lux_audio_volume` | 0 | 0 |  |
| `LEGACY:lux_cognitive_load_level` | legacy | `lux_cognitive_load_level` | 0 | 0 |  |
| `LEGACY:lux_color_blind_mode` | legacy | `lux_color_blind_mode` | 0 | 0 |  |
| `LEGACY:lux_guest_mode` | legacy | `lux_guest_mode` | 0 | 0 |  |
| `LEGACY:lux_keyboard_hint_shown` | legacy | `lux_keyboard_hint_shown` | 0 | 0 |  |
| `LEGACY:lux_keyboard_shortcuts` | legacy | `lux_keyboard_shortcuts` | 0 | 0 |  |
| `LEGACY:lux_reduced_motion` | legacy | `lux_reduced_motion` | 0 | 0 |  |
| `LEGACY:lux_settings_discovered` | legacy | `lux_settings_discovered` | 0 | 0 |  |
| `LEGACY:lux_text_size` | legacy | `lux_text_size` | 0 | 0 |  |
| `LEGACY:lux-active-tabs` | legacy | `lux-active-tabs` | 0 | 0 |  |
| `LEGACY:lux-local-mode-seen` | legacy | `lux-local-mode-seen` | 0 | 0 |  |
| `LEGACY:lux-player-id` | legacy | `lux-player-id` | **3** | **3** | `app/student/insights/page.tsx`, `lib/safe-storage.ts` |
| `LEGACY:lux-story-player-personas` | legacy | `lux-story-player-personas` | 0 | 0 |  |
| `LEGACY:playerId` | legacy | `playerId` | **1** | **1** | `app/student/insights/page.tsx` |
| `PLAYER_ID` | player_identity | `lux_story_v2_player_id` | **1** | **1** | `app/student/insights/page.tsx` |
| `PLAYER_PERSONAS` | player_identity | `lux_story_v2_player_personas` | **3** | **3** | `lib/player-persona.ts` |
| `GUEST_MODE` | ui_state | `lux_story_v2_guest_mode` | **2** | **1** | `app/welcome/page.tsx`, `tests/visual/visual-validation.spec.ts` |
| `KEYBOARD_HINT_SHOWN` | ui_state | `lux_story_v2_keyboard_hint_shown` | **3** | **3** | `components/StatefulGameInterface.tsx` |
| `LOCAL_MODE_SEEN` | ui_state | `lux_story_v2_local_mode_seen` | **2** | **2** | `hooks/game/useGameInitializer.ts` |
| `SETTINGS_DISCOVERED` | ui_state | `lux_story_v2_settings_discovered` | **2** | **2** | `components/InGameSettings.tsx` |
| `ACCESSIBILITY_PROFILE` | user_settings | `lux_story_v2_accessibility_profile` | **3** | **3** | `app/profile/page.tsx`, `lib/settings-sync.ts` |
| `AUDIO_MUTED` | user_settings | `lux_story_v2_audio_muted` | **14** | **7** | `app/profile/page.tsx`, `hooks/game/useAudioDirector.ts`, `lib/settings-sync.ts`, `tests/hooks/useAudioDirector.test.ts` (+1) |
| `AUDIO_VOLUME` | user_settings | `lux_story_v2_audio_volume` | **10** | **7** | `app/profile/page.tsx`, `hooks/game/useAudioDirector.ts`, `lib/settings-sync.ts`, `tests/hooks/useAudioDirector.test.ts` (+1) |
| `COGNITIVE_LOAD_LEVEL` | user_settings | `lux_story_v2_cognitive_load_level` | **3** | **3** | `app/profile/page.tsx`, `lib/settings-sync.ts` |
| `COLOR_BLIND_MODE` | user_settings | `lux_story_v2_color_blind_mode` | **3** | **3** | `app/profile/page.tsx`, `lib/settings-sync.ts` |
| `KEYBOARD_SHORTCUTS` | user_settings | `lux_story_v2_keyboard_shortcuts` | **3** | **3** | `lib/keyboard-shortcuts.ts` |
| `REDUCED_MOTION` | user_settings | `lux_story_v2_reduced_motion` | **4** | **4** | `components/InGameSettings.tsx`, `components/UnifiedMenu.tsx` |
| `TEXT_SIZE` | user_settings | `lux_story_v2_text_size` | **3** | **3** | `app/profile/page.tsx`, `lib/settings-sync.ts` |

### Unused Keys (Debt)

- `LEGACY:admin_view_preference`
- `LEGACY:currentSceneId`
- `LEGACY:grand-central-game-store`
- `LEGACY:grand-central-terminus-save-backup`
- `LEGACY:lastKnownSceneId`
- `LEGACY:lux-active-tabs`
- `LEGACY:lux-local-mode-seen`
- `LEGACY:lux-story-player-personas`
- `LEGACY:lux_accessibility_profile`
- `LEGACY:lux_audio_muted`
- `LEGACY:lux_audio_volume`
- `LEGACY:lux_cognitive_load_level`
- `LEGACY:lux_color_blind_mode`
- `LEGACY:lux_guest_mode`
- `LEGACY:lux_keyboard_hint_shown`
- `LEGACY:lux_keyboard_shortcuts`
- `LEGACY:lux_reduced_motion`
- `LEGACY:lux_settings_discovered`
- `LEGACY:lux_text_size`

### Unknown Key Usages (Archived, Allowed)

These unknown key identifiers occur only under `lib/archive/*` and are treated as non-blocking historical artifacts.

- `GAME_STATE` (2): `lib/archive/game-state.legacy.ts`
- `PATTERNS` (2): `lib/archive/game-state.legacy.ts`

## Environment Variables

Total referenced via `process.env`: **24** (public: **8**, server: **16**)

| Var | Kind | Used | Runtime | References |
| --- | --- | --- | --- | --- |
| `NEXT_PUBLIC_APP_URL` | public | **2** | 0 | `scripts/test-admin-improvements.ts`, `scripts/verify-production-admin.ts` |
| `NEXT_PUBLIC_BASE_URL` | public | **2** | **2** | `app/api/admin-proxy/urgency/route.ts` |
| `NEXT_PUBLIC_FF_RANKING_V2` | public | **5** | 0 | `tests/lib/feature-flags.test.ts` |
| `NEXT_PUBLIC_SENTRY_DSN` | public | **1** | **1** | `lib/env-validation.ts` |
| `NEXT_PUBLIC_SITE_URL` | public | **4** | **2** | `app/layout.tsx`, `lib/metadata.ts`, `scripts/test-admin-improvements.ts`, `scripts/verify-production-admin.ts` |
| `NEXT_PUBLIC_SUPABASE_ANON_KEY` | public | **11** | **10** | `app/api/health/db/route.ts`, `app/api/test-env/route.ts`, `lib/admin-supabase-client.ts`, `lib/env-validation.ts` (+5) |
| `NEXT_PUBLIC_SUPABASE_URL` | public | **19** | **17** | `app/api/admin-proxy/urgency/route.ts`, `app/api/health/db/route.ts`, `app/api/test-env/route.ts`, `lib/admin-supabase-client.ts` (+10) |
| `NEXT_PUBLIC_VERBOSE_LOGGING` | public | **1** | **1** | `lib/logger.ts` |
| `ADMIN_API_TOKEN` | server | **8** | **4** | `lib/admin-supabase-client.ts`, `lib/auth-utils.ts`, `lib/env-validation.ts`, `scripts/test-admin-improvements.ts` (+3) |
| `ANTHROPIC_API_KEY` | server | **3** | **3** | `app/api/advisor-briefing/route.ts`, `lib/env-validation.ts` |
| `CHOICE_SIMILARITY_THRESHOLD` | server | **2** | **2** | `lib/choice-generator.ts`, `lib/env-validation.ts` |
| `CORE_GAMEPLAY_SINCE` | server | **1** | 0 | `scripts/report-core-gameplay-diff.js` |
| `CORE_GAMEPLAY_STRICT` | server | **1** | 0 | `scripts/report-core-gameplay-diff.js` |
| `E2E_ADMIN_BYPASS_ENABLED` | server | **1** | **1** | `lib/admin-auth.ts` |
| `E2E_ADMIN_BYPASS_TOKEN` | server | **4** | **1** | `lib/admin-auth.ts`, `tests/e2e/admin/admin-auth.spec.ts`, `tests/e2e/admin/admin-users-pagination.spec.ts`, `tests/e2e/admin/telemetry.spec.ts` |
| `ENABLE_SEMANTIC_SIMILARITY` | server | **3** | **3** | `lib/choice-generator.ts`, `lib/env-validation.ts` |
| `GEMINI_API_KEY` | server | **6** | **3** | `app/api/samuel-dialogue/route.ts`, `lib/env-validation.ts`, `scripts/gemini-chat-interface-master-analyzer.js`, `scripts/gemini-skills-dashboard-analyzer.js` (+1) |
| `NODE_ENV` | server | **57** | **53** | `app/admin/(protected)/[userId]/error.tsx`, `app/admin/(protected)/layout.tsx`, `app/admin/(protected)/users/page.tsx`, `app/admin/error.tsx` (+35) |
| `SENTRY_DSN` | server | **2** | **2** | `lib/env-validation.ts` |
| `SUPABASE_ANON_KEY` | server | **3** | **3** | `app/api/health/db/route.ts`, `lib/env-validation.ts`, `lib/env.ts` |
| `SUPABASE_SERVICE_ROLE_KEY` | server | **14** | **10** | `app/api/admin-proxy/urgency/route.ts`, `lib/admin-supabase-client.ts`, `lib/api/api-utils.ts`, `lib/env-validation.ts` (+6) |
| `SUPABASE_URL` | server | **14** | **10** | `app/api/admin-proxy/urgency/route.ts`, `lib/admin-supabase-client.ts`, `lib/api/api-utils.ts`, `lib/env-validation.ts` (+6) |
| `VERCEL` | server | **1** | 0 | `scripts/validate-build-config.cjs` |
| `VERCEL_URL` | server | **5** | **2** | `app/api/admin-proxy/urgency/route.ts`, `scripts/verify-production-admin.ts` |

