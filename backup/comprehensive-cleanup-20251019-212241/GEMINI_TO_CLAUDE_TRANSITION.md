# Gemini to Claude Transition Documentation

## Overview
This document captures the API evolution from Google Gemini to Anthropic Claude for the Advisor Briefing feature.

## Initial Implementation: Gemini

### 1. Original Setup
**Package Installed**: `@google/generative-ai@^0.24.1` (still in package.json)
**Model Target**: Gemini 1.5 Pro

### 2. Initial Code Structure (Attempted)
```javascript
// Original attempt (conceptual - before we pivoted)
import { GoogleGenerativeAI } from '@google/generative-ai'

const genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY)
const model = genAI.getGenerativeModel({
  model: "gemini-1.5-pro-latest" // Later tried "gemini-2.0-pro"
})
```

### 3. Gemini API Key Testing
**First Key Tested**:
```
AIzaSyDEQloxDXlFD2HnFNUrAIr8aANhvr_Ivxg
```
**Result**: `Error: [GoogleGenerativeAI Error]: API_KEY_INVALID`

**Second Key Tested**:
```
AQ.Ab8RN6KYorD1DA5QUukOq5SawbNz40ShdYaiZgI_ai55877JtQ
```
**Result**: `Error: [GoogleGenerativeAI Error]: API_KEY_INVALID`

### 4. Error Output from Gemini
```
[AdvisorBriefing] Error: GoogleGenerativeAI Error: API_KEY_INVALID
Please pass a valid API Key. You can find your API key at https://aistudio.google.com/
```

## Strategic Pivot to Claude

### 1. Decision Point
**User Quote**: "Can we run MCP with Claude instead of Gemini?"
**Rationale**: Already in Claude Code environment with MCP capabilities

### 2. Implementation Changes

#### Before (Gemini):
```javascript
import { GoogleGenerativeAI } from '@google/generative-ai'
const genAI = new GoogleGenerativeAI(GEMINI_API_KEY)
const model = genAI.getGenerativeModel({ model: "gemini-1.5-pro-latest" })
```

#### After (Claude):
```javascript
import Anthropic from '@anthropic-ai/sdk'
const anthropic = new Anthropic({ apiKey: ANTHROPIC_API_KEY })
const message = await anthropic.messages.create({
  model: 'claude-3-5-sonnet-20241022',
  max_tokens: 2000,
  temperature: 0.7,
  messages: [{ role: 'user', content: masterPrompt }]
})
```

### 3. Package Changes
**Added**: `@anthropic-ai/sdk@^0.65.0`
**Kept**: `@google/generative-ai@^0.24.1` (for other scripts in /scripts folder)

## Leftover Gemini References

### Files Still Mentioning Gemini:
1. **`/app/api/advisor-briefing/route.ts`**
   - Line 4: "Generates AI-powered strategic briefings using Gemini 1.5 Pro" (comment)
   - Line 44: "Build a concise data summary for Gemini" (comment)

2. **`/components/admin/AdvisorBriefingModal.tsx`**
   - Footer shows: "Generated by Gemini 1.5 Pro" (display text)

3. **Scripts Directory** (64 files using Gemini for other features):
   - `/scripts/gemini-*.js` - Various analysis scripts
   - `/scripts/generate-dialogue-content.ts` - Content generation
   - `/lib/live-choice-engine.ts` - Live augmentation

## Current State

### What Works:
- ✅ Claude API integration for Advisor Briefing
- ✅ Intelligent fallback when API credits insufficient
- ✅ All functionality tested with MCP/Playwright

### What Needs Cleanup:
- [ ] Update comments in `/app/api/advisor-briefing/route.ts`
- [ ] Fix footer text in AdvisorBriefingModal showing "Gemini"
- [ ] Consider removing `@google/generative-ai` if no longer needed

### Gemini Still Used For:
- Live choice augmentation (`/lib/live-choice-engine.ts`)
- Content generation scripts (`/scripts/gemini-*.js`)
- These use the embedded API key: `AIzaSyDEQloxDXlFD2HnFNUrAIr8aANhvr_Ivxg`

## Testing Output Comparison

### Gemini (Failed):
```
Failed to generate briefing: 400
{"error": "API_KEY_INVALID"}
```

### Claude (Insufficient Credits):
```
Failed to generate briefing: 400
{"type":"error","error":{"type":"invalid_request_error",
"message":"Your credit balance is too low to access the Anthropic API"}}
```

### Fallback (Working):
Generated complete 5-section briefing using actual user data without API

## Conclusion

The transition from Gemini to Claude was successful, with the system now having:
1. Primary Claude integration for when API credits available
2. Intelligent fallback using real data when credits insufficient
3. Complete feature functionality regardless of API status

The Gemini infrastructure remains in the codebase for other features (content generation, live augmentation) but the Advisor Briefing feature has fully transitioned to Claude.